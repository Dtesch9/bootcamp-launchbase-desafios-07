## üîë Sistema de Login

Usando os conhecimentos adquiridos at√© aqui, voc√™ deve criar a parte de **autentica√ß√£o de usu√°rios** no Foodfy, onde **somente os usu√°rios cadastrados**, poder√£o ter acesso √† parte administrativa do sistema.

**Download dos arquivos**: https://github.com/Rocketseat/bootcamp-launchbase-desafios-07/archive/master.zip

## 1. Instru√ß√µes

- A partir de agora, somente usu√°rios cadastrados poder√£o ter acesso √†s rotas `/admin`
- O usu√°rio que tiver o valor de `true` no campo `is_admin` da tabela `users` ser√° considerado o **administrador do sistema** e:
    - Poder√° criar/editar/deletar **qualquer** usu√°rio, receita e chef
    - **Somente este** poder√° cadastrar/atualizar/deletar os chefs
    - **Somente este** poder√° cadastrar outros usu√°rios
    - **N√£o poder√°** deletar sua pr√≥pria conta
- Um usu√°rio comum **n√£o pode**
    - Editar ou deletar as **receitas** de outro usu√°rio
    - Editar ou deletar outros **usu√°rios**
    - Criar, editar ou deletar **chefs**
    - Deletar sua pr√≥pria conta.
- **As listagem** de receitas e chefs continuam **acess√≠veis a todos**, tanto para usu√°rios do sistema como para visitantes do site. (criar uma tela de acesso aberto para ver os chefs do Foodfy)

A partir disso, **cuidado com os bot√µes de acesso** que existem no site e na √°rea administrativa, bem como com as rotas do site. 

Crie uma estrutura de prote√ß√£o para impedir o acesso a **usu√°rios n√£o autenticados.**

Crie uma estrutura de prote√ß√£o para impedir que os usu√°rios que est√£o autenticados**, mas n√£o s√£o administradores**, n√£o tenham permiss√£o de acesso a certas rotas, conforme as instru√ß√µes acima.

Crie uma estrat√©gia que quando o administrador criar um usu√°rio novo, **o sistema ir√° criar uma senha** aleat√≥ria e enviar por email ao usu√°rio criado. **DICA***: Use a estrat√©gia de cria√ß√£o de TOKEN que voc√™ viu nas aulas*.

## 2. Rotas

- Use a estrutura de rotas que voc√™ aprendeu nas aulas, para criar as rotas de **entrar e sair do sistema** (login/logout); **solicita√ß√£o de recupera√ß√£o** de senha; gerenciamento de **usu√°rios.**
- Coloque as rotas de **perfis de usu√°rio** e **gerenciamento de usu√°rios** da seguinte forma
```js
// Rotas de perfil de um usu√°rio logado
routes.get('/admin/profile', ProfileController.index) // Mostrar o formul√°riocom dados do usu√°rio logado
routes.put('/admin/profile', ProfileController.put)// Editar o usu√°rio logado

// Rotas que o administrador ir√° acessar para gerenciar usu√°rios
routes.get('/admin/users', UserController.list) //Mostrar a lista de usu√°rios cadastrados
routes.post('/admin/users', UserController.post) //Cadastrar um usu√°rio
routes.put('/admin/users', UserController.put) // Editar um usu√°rio
routes.delete('/admin/users', UserController.delete) // Deletar um usu√°rio
```

## 3. Tabelas

Crie uma tabela de nome `users` com os seguintes campos:

- `id SERIAL PRIMARY KEY`
- `name TEXT NOT NULL`
- `email TEXT UNIQUE NOT NULL`
- `password TEXT NOT NULL`
- `reset_token TEXT`
- `reset_token_expires TEXT`
- `is_admin BOOLEAN DEFAULT false`
- `created_at TIMESTAMP DEFAULT(now())`
- `updated_at TIMESTAMP DEFAULT(now())`

ATEN√á√ÉO: Voc√™ vai precisar **criar relacionamentos entre usu√°rios e receitas** para cumprir a regra onde o usu√°rio poder√° ver a lista de receitas criadas por ele mesmo e somente ele poder√° deletar uma receita criada por ele. Portanto, crie uma chave estrangeira `foreign key` de nome `user_id` na tabela de receitas, apontando para o id da receita.

## 4. Sess√£o de Usu√°rio

Para usar a biblioteca `express-session` que trabalha com sess√£o e utiliza a configura√ß√£o `pg_simple`; voc√™ vai precisar da tabela abaixo.
```sql
CREATE TABLE "session" (
  "sid" varchar NOT NULL COLLATE "default",
  "sess" json NOT NULL,
  "expire" timestamp(6) NOT NULL
)
WITH (OIDS=FALSE);
ALTER TABLE "session" 
ADD CONSTRAINT "session_pkey" 
PRIMARY KEY ("sid") NOT DEFERRABLE INITIALLY IMMEDIATE;
```
## 5. Telas

O sistema ir√° ter as seguintes telas

- <a href="#login">Tela de **login**</a>
- Tela de **pedido de recupera√ß√£o de senha**

    *O sistema ir√° enviar um email com o link de recupera√ß√£o*

- <a href="#recovery">Tela de **recupera√ß√£o de senha**</a>
- <a href="#user">**Tela de informa√ß√µes** do usu√°rio.</a>

    *O usu√°rio dever√° preencher sua senha para alterar suas informa√ß√µes* 

- Tela de **listagem de receitas do usu√°rio**

    *Mostrar somente as receitas cadastradas pelo usu√°rio logado*

- <a href="#users">Tela de **listagem/gerenciamento** de usu√°rios do sistema</a>

    **LEMBRE:** *Somente o administrador tem acesso a essa parte do sistema*

**Login**
<img id="login" src="../layouts/preview/desafio-07-session-login.png">

**Recupera√ß√£o de Senha**
<img id="recovery" src="../layouts/preview/desafio-07-session-esqueceu-senha.png">

<img id="reset" src="../layouts/preview/desafio-07-session-reset-senha.png">

**Usu√°rio Logado**
<img id="user" src="../layouts/preview/desafio-07-admin-profile-conta-de-usu√°rio.png">

**Gerenciamento de Usu√°rios: Listagem**
<img id="admin-users" src="../layouts/preview/desafio-07-admin-users-listagem.png">

<img src="../layouts/preview/desafio-07-admin-users-cria√ß√£o.png">

<img src="../layouts/preview/desafio-07-admin-users-edi√ß√£o.png">



# üö® Alertas e Erros

Voc√™ dever√° criar uma estrat√©gia de alertas visuais aos usu√°rios.

Esses alertas servir√£o para comunicar os usu√°rios do sistema sobre poss√≠veis erros ou sucesso, mantendo uma boa comunica√ß√£o entre o sistema e o usu√°rio.

Exemplo:
<img src="../layouts/preview/desafio-07-session-login-erro.png">

## Quando utilizar os alertas?

Na cria√ß√£o, atualiza√ß√£o ou remo√ß√£o uma receita, chef, conta de usu√°rio, bem como login e logout.

Quando falhar, exiba um alerta de erro. 

Caso haja sucesso na transa√ß√£o, exibir alerta de sucesso.

Caso haja algum erro de valida√ß√£o de campos do formul√°rio, sinalizar de forma visual.

# ‚úâÔ∏è Emails

Voc√™ dever√° criar estrat√©gias de envio de emails para o Foodfy

- Quando um usu√°rio for cadastrado no sistema, ele ir√° receber um email com o acesso ao sistema.
- Quando um usu√°rio esquecer a senha, e fizer o pedido de recupera√ß√£o, ele ir√° receber no email dele um link especial para a p√°gina de recupera√ß√£o de senha.

Sucesso!!